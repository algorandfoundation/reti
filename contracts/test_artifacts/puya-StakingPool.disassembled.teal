#pragma version 11
intcblock 0 1 64 8 200 157 300 2100000 1000000 30857 0
bytecblock 0x7374616b657273 0x63726561746f72417070 0x76616c696461746f724964 0x706f6f6c4964 0x151f7c75 0x7374616b6564 0x726f756e6473506572446179 0x7374616b65416363756d756c61746f72 0x0002 0x62696e526f756e645374617274 0x6e756d5374616b657273 0x726577617264416363756d756c61746f72 0x65776d61 0x75aff61d 0x64 0x6d696e456e7472795374616b65 0x6c6173745061796f7574 0x65706f63684e756d626572 0x000100000000000f4240 0x0001 0x0c2245e1 0x068101 0x00000000000000000000000000000001 0x00000000000000000000000000000000 0xa2dc51b5 0x572767d1 0x4df8d86e 0x0003
txn OnCompletion
!
assert
txn ApplicationID
bz label1
pushbytess 0x3172ca9d 0x47cfcc04 0xf9c70cbd 0x421b5abe 0xf5892d56 0x5cfbb057 0x63f3f28b 0x86a3725c 0xefc2608d 0x9cee2e40 0x51ef3b21 0xa24e2717
bytec 20 // 0x0c2245e1
txna ApplicationArgs 0
match label2 label3 label4 label5 label6 label7 label8 label9 label10 label11 label12 label13 label14
err
label2:
intc_1 // 1
return
label1:
pushbytes 0x59e90aa6 // 0x59e90aa6
txna ApplicationArgs 0
match label15
err
label33:
proto 2 0
frame_dig -2
pushint 10
+
label19:
frame_dig 0
global OpcodeBudget
>
bz label16
itxn_begin
pushint 6
itxn_field TypeEnum
pushint 5
itxn_field OnCompletion
bytec 21 // 0x068101
itxn_field ApprovalProgram
bytec 21 // 0x068101
itxn_field ClearStateProgram
frame_dig -1
switch label17 label18
label20:
itxn_submit
b label19
label18:
global MinTxnFee
itxn_field Fee
b label20
label17:
intc_0 // 0
itxn_field Fee
b label20
label16:
retsub
label60:
proto 2 3
intc_0 // 0
pushbytes 0x // ""
dup
bytec 22 // 0x00000000000000000000000000000001
frame_dig -2
intc_0 // 0
extract_uint16
intc_0 // 0
label22:
frame_dig 5
frame_dig 4
<
bz label21
frame_dig -2
extract 2 0
frame_dig 5
dup
cover 2
intc_3 // 8
*
intc_3 // 8
extract3
frame_dig 3
b*
dup
len
pushint 16
<=
assert
pushint 16
bzero
b|
frame_bury 3
intc_1 // 1
+
frame_bury 5
b label22
label21:
bytec 22 // 0x00000000000000000000000000000001
frame_bury 0
frame_dig -1
intc_0 // 0
extract_uint16
frame_bury 1
intc_0 // 0
frame_bury 2
label24:
frame_dig 2
frame_dig 1
<
bz label23
frame_dig -1
extract 2 0
frame_dig 2
dup
cover 2
intc_3 // 8
*
intc_3 // 8
extract3
frame_dig 0
b*
dup
len
pushint 16
<=
assert
pushint 16
bzero
b|
frame_bury 0
intc_1 // 1
+
frame_bury 2
b label24
label23:
frame_dig 3
frame_dig 0
b/
dup
len
intc_3 // 8
<=
assert
intc_3 // 8
bzero
b|
btoi
frame_dig -2
frame_dig -1
frame_bury 2
frame_bury 1
frame_bury 0
retsub
label15:
txna ApplicationArgs 1
dup
len
intc_3 // 8
==
assert
btoi
dup
txna ApplicationArgs 2
dup
len
intc_3 // 8
==
assert
btoi
swap
txna ApplicationArgs 3
dup
len
intc_3 // 8
==
assert
btoi
swap
txna ApplicationArgs 4
dup
len
intc_3 // 8
==
assert
btoi
swap
bnz label25
dig 2
!
assert
dig 1
!
assert
label27:
dupn 2
intc 8 // 1000000
>=
assert
bytec_1 // "creatorApp"
dig 5
app_global_put
bytec_2 // "validatorId"
dig 4
app_global_put
bytec_3 // "poolId"
dig 3
app_global_put
bytec 10 // "numStakers"
intc_0 // 0
app_global_put
bytec 5 // "staked"
intc_0 // 0
app_global_put
bytec 15 // "minEntryStake"
swap
app_global_put
bytec 16 // "lastPayout"
global Round
app_global_put
bytec 17 // "epochNumber"
intc_0 // 0
app_global_put
callsub label26
global Round
dup
intc_0 // 0
bytec 6 // "roundsPerDay"
app_global_get_ex
assert
%
-
bytec 9 // "binRoundStart"
swap
app_global_put
bytec 7 // "stakeAccumulator"
bytec 23 // 0x00000000000000000000000000000000
app_global_put
bytec 11 // "rewardAccumulator"
intc_0 // 0
app_global_put
bytec 12 // "ewma"
bytec 23 // 0x00000000000000000000000000000000
app_global_put
intc_1 // 1
return
label25:
dig 2
assert
dig 1
assert
b label27
label3:
txn GroupIndex
intc_1 // 1
-
dup
gtxns TypeEnum
intc_1 // 1
==
assert
bytec_0 // "stakers"
box_len
bury 1
!
assert
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
itob
bytec 13 // 0x75aff61d
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dup
extract 0 4
bytec 4 // 0x151f7c75
==
assert
intc 5 // 157
extract_uint64
dup
bz label28
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
intc_1 // 1
==
bz label28
intc_1 // 1
label30:
pushint 100000
*
pushint 5225300
+
dig 2
dup
gtxns Receiver
global CurrentApplicationAddress
==
swap
gtxns Amount
uncover 2
==
&&
assert
bytec_0 // "stakers"
pushint 12800
box_create
pop
dup
bz label29
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
intc_1 // 1
==
bz label29
itxn_begin
global CurrentApplicationAddress
intc_0 // 0
itxn_field AssetAmount
itxn_field AssetReceiver
dup
itxn_field XferAsset
pushint 4
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
label29:
intc_1 // 1
return
label28:
intc_0 // 0
b label30
label4:
intc_0 // 0
dup
pushbytes 0x // ""
txn GroupIndex
intc_1 // 1
-
dup
gtxns TypeEnum
intc_1 // 1
==
assert
txna ApplicationArgs 1
dup
cover 2
dup
len
pushint 32
==
assert
bytec_0 // "stakers"
box_len
bury 1
assert
txn Sender
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
app_params_get AppAddress
assert
==
assert
global ZeroAddress
!=
assert
callsub label31
dup
gtxns Sender
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
app_params_get AppAddress
assert
==
dig 1
gtxns Receiver
global CurrentApplicationAddress
==
&&
swap
gtxns Amount
dup
uncover 2
intc_1 // 1
&&
assert
global Round
pushint 320
+
swap
intc_0 // 0
swap
intc_0 // 0
bytec 5 // "staked"
app_global_get_ex
assert
dig 1
+
bytec 5 // "staked"
swap
app_global_put
intc_0 // 0
bytec 9 // "binRoundStart"
app_global_get_ex
assert
intc_0 // 0
bytec 6 // "roundsPerDay"
app_global_get_ex
assert
+
global Round
-
intc_0 // 0
bytec 7 // "stakeAccumulator"
app_global_get_ex
assert
uncover 2
itob
dup
cover 3
uncover 2
itob
b*
b+
dup
len
pushint 16
<=
assert
pushint 16
bzero
b|
bytec 7 // "stakeAccumulator"
swap
app_global_put
intc_0 // 0
label36:
bytec_0 // "stakers"
box_len
bury 1
assert
dup
intc 4 // 200
<
bz label32
intc 6 // 300
intc_0 // 0
callsub label33
dup
intc_2 // 64
*
dup
bury 8
bytec_0 // "stakers"
swap
intc_2 // 64
box_extract
dup
bury 9
extract 0 32
dup
bury 10
dig 6
==
bz label34
bytec_0 // "stakers"
dig 7
dup
cover 2
intc_2 // 64
box_extract
pushint 32
extract_uint64
dig 6
+
itob
dig 9
swap
replace2 32
dig 5
itob
replace2 56
bytec_0 // "stakers"
cover 2
box_replace
label37:
dig 3
itob
bytec 4 // 0x151f7c75
swap
concat
log
intc_1 // 1
return
label34:
dig 2
bnz label35
dig 8
global ZeroAddress
==
bz label35
dup
intc_1 // 1
+
bury 3
label35:
dup
intc_1 // 1
+
bury 1
b label36
label32:
dig 2
dup
!
!
assert
intc_0 // 0
bytec 15 // "minEntryStake"
app_global_get_ex
assert
dig 6
<=
assert
intc_1 // 1
-
intc_2 // 64
*
bytec_0 // "stakers"
dig 1
intc_2 // 64
box_extract
extract 0 32
global ZeroAddress
==
assert
dig 6
dig 3
concat
intc_0 // 0
itob
swap
dig 1
concat
swap
concat
dig 5
itob
concat
bytec_0 // "stakers"
cover 2
box_replace
intc_0 // 0
bytec 10 // "numStakers"
app_global_get_ex
assert
intc_1 // 1
+
bytec 10 // "numStakers"
swap
app_global_put
b label37
label5:
intc_0 // 0
pushbytes 0x // ""
dupn 5
txna ApplicationArgs 1
dupn 2
len
pushint 32
==
assert
txna ApplicationArgs 2
dup
len
intc_3 // 8
==
assert
btoi
swap
txn Sender
!=
bz label38
callsub label39
assert
label38:
callsub label31
intc_0 // 0
bury 5
label49:
bytec_0 // "stakers"
box_len
bury 1
assert
dig 4
dup
intc 4 // 200
<
assert
intc 6 // 300
intc_0 // 0
callsub label33
intc_2 // 64
*
dup
bury 7
bytec_0 // "stakers"
swap
intc_2 // 64
box_extract
dup
bury 10
extract 0 32
dig 2
==
bz label40
dup
bnz label41
bytec_0 // "stakers"
dig 6
intc_2 // 64
box_extract
pushint 32
extract_uint64
bury 1
label41:
bytec_0 // "stakers"
dig 6
intc_2 // 64
box_extract
pushint 32
extract_uint64
dup
dig 2
dup
cover 3
<
!
assert
dig 1
-
itob
dig 10
swap
replace2 32
dup
bury 11
intc_0 // 0
bytec 5 // "staked"
app_global_get_ex
assert
uncover 2
-
bytec 5 // "staked"
swap
app_global_put
intc_0 // 0
bury 9
pushint 48
extract_uint64
dup
bury 8
bz label42
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
intc_1 // 1
==
bz label43
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
itob
bytec 13 // 0x75aff61d
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dup
extract 0 4
bytec 4 // 0x151f7c75
==
assert
itxn_begin
intc 5 // 157
extract_uint64
dig 7
itxn_field AssetAmount
dig 2
itxn_field AssetReceiver
itxn_field XferAsset
pushint 4
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
intc_0 // 0
itob
dig 9
swap
replace2 48
bury 9
label48:
dig 6
bury 8
label42:
dig 8
pushint 32
extract_uint64
dup
bury 4
bz label44
intc_0 // 0
bytec 15 // "minEntryStake"
app_global_get_ex
assert
dig 3
<=
bz label45
label44:
intc_1 // 1
label47:
assert
itxn_begin
pushbytes 0x756e7374616b6564 // "unstaked"
itxn_field Note
dig 1
itxn_field Receiver
dup
itxn_field Amount
intc_1 // 1
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
intc_0 // 0
bury 4
dig 2
bnz label46
intc_0 // 0
bytec 10 // "numStakers"
app_global_get_ex
assert
intc_1 // 1
-
bytec 10 // "numStakers"
swap
app_global_put
dig 8
global ZeroAddress
replace2 0
intc_0 // 0
itob
swap
dig 1
replace2 40
swap
replace2 48
bury 9
intc_1 // 1
bury 4
label46:
bytec_0 // "stakers"
dig 6
dig 10
box_replace
intc_0 // 0
bytec 9 // "binRoundStart"
app_global_get_ex
assert
intc_0 // 0
bytec 6 // "roundsPerDay"
app_global_get_ex
assert
+
global Round
-
dig 1
dup
uncover 2
*
itob
intc_0 // 0
bytec 7 // "stakeAccumulator"
app_global_get_ex
assert
swap
b-
dup
len
pushint 16
<=
assert
pushint 16
bzero
b|
bytec 7 // "stakeAccumulator"
swap
app_global_put
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
global CurrentApplicationID
uncover 2
itob
uncover 2
itob
concat
swap
itob
concat
uncover 2
itob
dig 10
itob
pushbytes 0x00 // 0x00
intc_0 // 0
dig 9
setbit
bytec 24 // 0xa2dc51b5
itxn_field ApplicationArgs
uncover 3
itxn_field ApplicationArgs
dig 5
itxn_field ApplicationArgs
uncover 2
itxn_field ApplicationArgs
swap
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
intc_1 // 1
return
label45:
intc_0 // 0
b label47
label43:
intc_0 // 0
itob
dig 9
swap
replace2 48
bury 9
b label48
label40:
dig 4
intc_1 // 1
+
bury 5
b label49
label6:
intc_0 // 0
dup
pushbytes 0x // ""
dup
txn Sender
intc_0 // 0
label54:
bytec_0 // "stakers"
box_len
bury 1
assert
dupn 2
intc 4 // 200
<
assert
intc 6 // 300
intc_0 // 0
callsub label33
intc_2 // 64
*
dup
bury 4
bytec_0 // "stakers"
swap
intc_2 // 64
box_extract
dup
bury 6
extract 0 32
dig 2
==
bz label50
bytec_0 // "stakers"
dig 3
intc_2 // 64
box_extract
dup
extract 48 8
bury 7
pushint 48
extract_uint64
dup
bury 5
bz label51
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
intc_1 // 1
==
bz label52
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
itob
bytec 13 // 0x75aff61d
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dup
extract 0 4
bytec 4 // 0x151f7c75
==
assert
itxn_begin
intc 5 // 157
extract_uint64
dig 4
itxn_field AssetAmount
dig 2
itxn_field AssetReceiver
itxn_field XferAsset
pushint 4
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
intc_0 // 0
itob
dig 5
swap
replace2 48
bury 5
label53:
bytec_0 // "stakers"
dig 3
dig 6
box_replace
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
global CurrentApplicationID
uncover 2
itob
uncover 2
itob
concat
swap
itob
concat
intc_0 // 0
itob
bytec 24 // 0xa2dc51b5
itxn_field ApplicationArgs
swap
itxn_field ApplicationArgs
dig 3
itxn_field ApplicationArgs
itxn_field ApplicationArgs
dig 6
itxn_field ApplicationArgs
pushbytes 0x00 // 0x00
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
label51:
intc_1 // 1
return
label52:
intc_0 // 0
itob
dig 5
swap
replace2 48
bury 5
b label53
label50:
dup
intc_1 // 1
+
bury 1
b label54
label7:
pushbytes 0x // ""
txna ApplicationArgs 1
dup
len
pushint 32
==
assert
intc_0 // 0
label56:
bytec_0 // "stakers"
box_len
bury 1
assert
dupn 2
intc 4 // 200
<
assert
intc 4 // 200
intc_0 // 0
callsub label33
intc_2 // 64
*
dup
bury 4
bytec_0 // "stakers"
swap
intc_2 // 64
box_extract
extract 0 32
dig 2
==
bz label55
bytec_0 // "stakers"
dig 3
intc_2 // 64
box_extract
bytec 4 // 0x151f7c75
swap
concat
log
intc_1 // 1
return
label55:
dup
intc_1 // 1
+
bury 1
b label56
label8:
txna ApplicationArgs 1
dup
len
pushint 32
==
assert
txna ApplicationArgs 2
dup
len
intc_3 // 8
==
assert
btoi
txna ApplicationArgs 3
dup
len
intc_3 // 8
==
assert
btoi
txn Sender
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
app_params_get AppAddress
assert
==
assert
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
intc_1 // 1
==
assert
dig 1
assert
itxn_begin
itxn_field AssetAmount
itxn_field XferAsset
itxn_field AssetReceiver
pushint 4
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
intc_1 // 1
return
label9:
txna ApplicationArgs 1
dup
intc_0 // 0
extract_uint16
pushint 2
+
dig 1
len
==
assert
extract 2 0
callsub label39
assert
pushbytes 0x616c676f64566572 // "algodVer"
swap
app_global_put
intc_1 // 1
return
label10:
intc_0 // 0
dupn 4
pushbytes 0x // ""
dupn 28
intc_0 // 0
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
itob
bytec 13 // 0x75aff61d
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dupn 2
extract 0 4
bytec 4 // 0x151f7c75
==
assert
dup
pushint 173
extract_uint32
dup
cover 2
global Round
dup
dig 2
%
dig 1
swap
-
dup
cover 2
cover 4
intc_0 // 0
bytec 16 // "lastPayout"
app_global_get_ex
assert
dup
uncover 4
%
-
uncover 2
!=
assert
callsub label31
bytec 16 // "lastPayout"
swap
app_global_put
intc_0 // 0
bytec 17 // "epochNumber"
app_global_get_ex
assert
intc_1 // 1
+
bytec 17 // "epochNumber"
swap
app_global_put
intc 5 // 157
extract_uint64
dup
global CurrentApplicationID
swap
global CurrentApplicationAddress
swap
bz label57
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
intc_1 // 1
!=
bz label58
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
itob
intc_1 // 1
itob
bytec 25 // 0x572767d1
itxn_field ApplicationArgs
swap
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dup
extract 4 0
swap
extract 0 4
bytec 4 // 0x151f7c75
==
assert
btoi
dup
bury 3
app_params_get AppAddress
swap
bury 2
assert
label58:
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
intc_1 // 1
==
bz label59
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
itob
bytec 26 // 0x4df8d86e
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dup
extract 4 0
bury 8
extract 0 4
bytec 4 // 0x151f7c75
==
assert
label57:
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
itob
pushbytes 0x1f2f0109 // 0x1f2f0109
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dup
extract 0 4
bytec 4 // 0x151f7c75
==
assert
dup
pushint 22
extract_uint64
bury 22
global CurrentApplicationAddress
acct_params_get AcctBalance
assert
intc_0 // 0
bytec 5 // "staked"
app_global_get_ex
assert
-
global CurrentApplicationAddress
acct_params_get AcctMinBalance
assert
-
bury 37
intc_0 // 0
bury 27
online_stake
itob
bytec 8 // 0x0002
swap
concat
pushint 100
itob
concat
pushint 1000
itob
bury 41
pushbytes 0x000100000000000003e8 // 0x000100000000000003e8
callsub label60
popn 2
dup
bury 36
swap
pushint 14
extract_uint64
dup
bury 12
<
bz label61
intc_1 // 1
bury 26
label61:
intc_0 // 0
bury 16
intc_0 // 0
bury 14
intc_0 // 0
bury 13
intc_0 // 0
bury 29
dig 2
bz label62
dup
dig 3
asset_holding_get AssetBalance
pop
dig 21
-
dig 6
pushint 165
extract_uint64
dup
bury 10
>=
bz label62
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
intc_1 // 1
-
dig 7
extract 0 192
swap
intc_3 // 8
*
intc_3 // 8
extract3
dig 8
itob
bytec 8 // 0x0002
swap
concat
swap
concat
bytec 18 // 0x000100000000000f4240
callsub label60
popn 2
bury 16
label62:
dig 15
bnz label63
dig 35
intc 8 // 1000000
<
bz label63
pushbytes 0x21746f6b656e2626216e6f616c676f20746f20706179 // "!token&&!noalgo to pay"
log
label77:
intc_1 // 1
return
label63:
dig 25
bz label64
dig 5
pushint 177
extract_uint32
dig 36
dup
cover 2
itob
bytec 8 // 0x0002
swap
concat
swap
itob
dig 1
swap
concat
bytec 18 // 0x000100000000000f4240
callsub label60
popn 2
swap
dig 36
itob
concat
dig 12
itob
bytec 19 // 0x0001
swap
concat
callsub label60
popn 2
dup
bury 34
cover 2
-
dup
bury 32
>
bz label65
dig 29
bury 31
label65:
dig 35
dig 31
dup
cover 2
-
dup
bury 31
itxn_begin
txn FirstValid
intc_1 // 1
-
block BlkFeeSink
pushbytes 0x706f6f6c207361747572617465642c2065786365737320746f206665652073696e6b // "pool saturated, excess to fee sink"
itxn_field Note
itxn_field Receiver
itxn_field Amount
intc_1 // 1
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
bury 36
label78:
intc_0 // 0
bury 27
dig 35
bnz label66
dig 15
bz label67
label66:
intc_0 // 0
bury 22
intc_0 // 0
bury 28
dig 35
bury 35
dig 15
bury 15
label71:
bytec_0 // "stakers"
box_len
bury 1
assert
dig 27
intc 4 // 200
<
bz label68
pushint 400
intc_0 // 0
callsub label33
dig 27
intc_2 // 64
*
dup
bury 34
bytec_0 // "stakers"
swap
intc_2 // 64
box_extract
dup
bury 39
extract 0 32
global ZeroAddress
!=
bz label69
bytec_0 // "stakers"
dig 33
intc_2 // 64
box_extract
pushint 56
extract_uint64
dup
bury 13
dig 4
>=
bz label70
bytec_0 // "stakers"
dig 33
intc_2 // 64
box_extract
pushint 32
extract_uint64
dig 22
+
bury 22
label69:
dig 27
intc_1 // 1
+
bury 28
b label71
label70:
dig 3
dig 12
-
dup
bury 21
dig 5
<
bz label69
bytec_0 // "stakers"
dig 33
intc_2 // 64
box_extract
pushint 32
extract_uint64
dup
bury 12
dig 22
+
bury 22
dig 19
pushint 1000
*
dig 5
/
bury 19
dig 14
bz label72
dig 10
itob
bytec 27 // 0x0003
swap
concat
dig 16
itob
concat
dig 19
itob
concat
intc_0 // 0
bytec 5 // "staked"
app_global_get_ex
assert
itob
bytec 8 // 0x0002
swap
concat
dig 40
concat
callsub label60
popn 2
dig 15
dig 1
-
bury 16
bytec_0 // "stakers"
dig 34
intc_2 // 64
box_extract
pushint 48
extract_uint64
dig 1
+
itob
dig 39
swap
replace2 48
bury 39
dig 14
+
bury 14
label72:
dig 37
dup
pushint 32
extract_uint64
dup
itob
bytec 27 // 0x0003
swap
concat
dig 38
itob
concat
dig 21
itob
concat
intc_0 // 0
bytec 5 // "staked"
app_global_get_ex
assert
itob
bytec 8 // 0x0002
swap
concat
dig 42
concat
callsub label60
popn 2
dig 37
dig 1
-
bury 38
swap
dig 1
+
itob
uncover 2
swap
replace2 32
dup
pushint 40
extract_uint64
dig 2
+
itob
replace2 40
dig 28
uncover 2
+
bury 28
bytec_0 // "stakers"
dig 34
uncover 2
box_replace
b label69
label68:
intc_0 // 0
bytec 5 // "staked"
app_global_get_ex
assert
dig 22
-
dup
bury 24
bz label67
intc_0 // 0
bury 25
label76:
bytec_0 // "stakers"
box_len
bury 1
assert
dig 24
intc 4 // 200
<
bz label67
intc 4 // 200
intc_0 // 0
callsub label33
dig 24
intc_2 // 64
*
dup
bury 33
bytec_0 // "stakers"
swap
intc_2 // 64
box_extract
dup
bury 38
extract 0 32
global ZeroAddress
!=
bz label73
bytec_0 // "stakers"
dig 32
intc_2 // 64
box_extract
pushint 56
extract_uint64
dup
bury 10
dig 4
<
bz label73
dig 3
dig 9
-
dig 5
>=
bz label73
dig 14
bz label74
bytec_0 // "stakers"
dig 32
dup
cover 2
intc_2 // 64
box_extract
extract 32 8
bytec 8 // 0x0002
swap
concat
dig 16
itob
concat
dig 24
itob
bytec 19 // 0x0001
swap
concat
callsub label60
popn 2
bytec_0 // "stakers"
uncover 2
intc_2 // 64
box_extract
pushint 48
extract_uint64
dig 1
+
itob
dig 38
swap
replace2 48
bury 38
dig 14
+
bury 14
label74:
dig 34
bz label75
dig 36
dup
pushint 32
extract_uint64
dup
itob
bytec 8 // 0x0002
swap
concat
dig 37
itob
concat
dig 25
itob
bytec 19 // 0x0001
swap
concat
callsub label60
popn 2
swap
dig 1
+
itob
uncover 2
swap
replace2 32
dup
pushint 40
extract_uint64
dig 2
+
itob
replace2 40
bury 38
dig 27
+
bury 27
label75:
bytec_0 // "stakers"
dig 32
dig 38
box_replace
label73:
dig 24
intc_1 // 1
+
bury 25
b label76
label67:
intc_0 // 0
bytec 9 // "binRoundStart"
app_global_get_ex
assert
intc_0 // 0
bytec 6 // "roundsPerDay"
app_global_get_ex
assert
+
global Round
-
intc_0 // 0
bytec 5 // "staked"
app_global_get_ex
assert
dig 28
dup
cover 2
+
bytec 5 // "staked"
swap
app_global_put
intc_0 // 0
bytec 7 // "stakeAccumulator"
app_global_get_ex
assert
dig 1
itob
uncover 3
itob
dig 1
b*
uncover 2
b+
dup
len
pushint 16
<=
assert
pushint 16
bzero
b|
bytec 7 // "stakeAccumulator"
swap
app_global_put
intc_0 // 0
bytec 11 // "rewardAccumulator"
app_global_get_ex
assert
uncover 2
+
bytec 11 // "rewardAccumulator"
swap
app_global_put
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
global CurrentApplicationID
uncover 2
itob
uncover 2
itob
concat
swap
itob
concat
dig 16
itob
dig 16
itob
dig 33
itob
pushbytes 0x418fcefc // 0x418fcefc
itxn_field ApplicationArgs
uncover 3
itxn_field ApplicationArgs
uncover 4
itxn_field ApplicationArgs
uncover 2
itxn_field ApplicationArgs
swap
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
b label77
label64:
dig 5
pushint 177
extract_uint32
dup
bury 19
bz label78
dig 35
dup
itob
bytec 8 // 0x0002
swap
concat
dig 19
itob
concat
bytec 18 // 0x000100000000000f4240
callsub label60
popn 2
dup
bury 15
swap
dig 1
-
bury 37
bz label78
intc_0 // 0
bury 24
dig 5
dup
extract 44 32
dup
cover 2
bury 43
extract 181 32
dup
bury 42
!=
bz label79
dig 40
dup
acct_params_get AcctBalance
assert
swap
acct_params_get AcctMinBalance
assert
-
intc 7 // 2100000
<
bz label79
dig 12
dup
intc 7 // 2100000
<
intc 7 // 2100000
cover 2
select
dup
bury 25
itxn_begin
pushbytes 0x76616c696461746f722072657761726420746f206d616e6167657220666f722066756e64696e672065706f63682075706461746573 // "validator reward to manager for funding epoch updates"
itxn_field Note
dig 41
itxn_field Receiver
itxn_field Amount
intc_1 // 1
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
label79:
dig 12
dig 24
-
dup
bury 18
bz label78
itxn_begin
pushbytes 0x76616c696461746f7220726577617264 // "validator reward"
itxn_field Note
dig 39
itxn_field Receiver
dig 16
itxn_field Amount
intc_1 // 1
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
b label78
label59:
itxn_begin
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
global CurrentApplicationID
uncover 2
itob
uncover 2
itob
concat
swap
itob
concat
bytec 20 // 0x0c2245e1
itxn_field ApplicationArgs
itxn_field ApplicationArgs
dig 1
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dup
extract 4 0
bury 8
extract 0 4
bytec 4 // 0x151f7c75
==
assert
b label57
label11:
txn GroupIndex
intc_1 // 1
-
dup
gtxns TypeEnum
intc_1 // 1
==
assert
txna ApplicationArgs 1
dup
len
pushint 32
==
assert
txna ApplicationArgs 2
dup
len
pushint 32
==
assert
txna ApplicationArgs 3
dup
len
intc_2 // 64
==
assert
txna ApplicationArgs 4
dup
len
intc_3 // 8
==
assert
btoi
txna ApplicationArgs 5
dup
len
intc_3 // 8
==
assert
btoi
txna ApplicationArgs 6
dup
len
intc_3 // 8
==
assert
btoi
callsub label39
assert
global CurrentApplicationAddress
acct_params_get AcctIncentiveEligible
pop
bnz label80
global PayoutsGoOnlineFee
label81:
dig 7
dup
gtxns Receiver
global CurrentApplicationAddress
==
swap
gtxns Amount
dig 2
==
&&
assert
itxn_begin
dig 1
itxn_field VoteKeyDilution
dig 2
itxn_field VoteLast
dig 3
itxn_field VoteFirst
dig 4
itxn_field StateProofPK
dig 5
itxn_field SelectionPK
dig 6
itxn_field VotePK
pushint 2
itxn_field TypeEnum
itxn_field Fee
itxn_submit
intc_1 // 1
return
label80:
intc_0 // 0
b label81
label12:
txn Sender
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
app_params_get AppAddress
assert
!=
bz label82
callsub label39
assert
label82:
itxn_begin
pushint 2
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
intc_1 // 1
return
label13:
txna ApplicationArgs 1
dup
len
intc_3 // 8
==
assert
btoi
txna ApplicationArgs 2
dup
intc_0 // 0
extract_uint16
pushint 2
+
dig 1
len
==
assert
extract 2 0
callsub label39
assert
itxn_begin
intc 10 // 0
dig 2
itob
global CurrentApplicationAddress
uncover 4
itxn_field Applications
pushbytes 0x7665726966795f6e66645f61646472 // "verify_nfd_addr"
itxn_field ApplicationArgs
uncover 3
itxn_field ApplicationArgs
swap
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
intc_1 // 1
return
label14:
txna ApplicationArgs 1
dup
len
pushint 24
==
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
dig 1
extract 0 8
dig 2
intc_0 // 0
extract_uint64
dig 2
==
assert
intc_0 // 0
bytec_3 // "poolId"
app_global_get_ex
assert
intc_1 // 1
==
assert
dig 2
extract 8 8
dig 3
intc_3 // 8
extract_uint64
intc_1 // 1
!=
assert
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
bytec 25 // 0x572767d1
itxn_field ApplicationArgs
uncover 2
itxn_field ApplicationArgs
swap
itxn_field ApplicationArgs
dup
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dup
extract 4 0
swap
extract 0 4
bytec 4 // 0x151f7c75
==
assert
btoi
uncover 3
pushint 16
extract_uint64
swap
dig 1
==
assert
txn Sender
swap
app_params_get AppAddress
assert
==
assert
itxn_begin
swap
itob
bytec 26 // 0x4df8d86e
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dup
extract 4 0
swap
extract 0 4
bytec 4 // 0x151f7c75
==
assert
bytec 4 // 0x151f7c75
swap
concat
log
intc_1 // 1
return
label39:
proto 0 1
itxn_begin
intc_0 // 0
bytec_1 // "creatorApp"
app_global_get_ex
assert
intc_0 // 0
bytec_2 // "validatorId"
app_global_get_ex
assert
itob
pushbytes 0x2fa22c4b // 0x2fa22c4b
itxn_field ApplicationArgs
itxn_field ApplicationArgs
itxn_field ApplicationID
pushint 6
itxn_field TypeEnum
intc_0 // 0
itxn_field Fee
itxn_submit
itxn LastLog
dupn 2
extract 0 4
bytec 4 // 0x151f7c75
==
assert
txn Sender
swap
extract 4 32
==
bnz label83
txn Sender
frame_dig 0
extract 36 32
==
bz label84
label83:
intc_1 // 1
label85:
swap
retsub
label84:
intc_0 // 0
b label85
label31:
proto 0 0
intc_0 // 0
dupn 5
bytec 6 // "roundsPerDay"
app_global_get_ex
swap
dup
uncover 2
assert
global Round
intc_0 // 0
bytec 9 // "binRoundStart"
app_global_get_ex
assert
uncover 2
+
>=
bz label86
intc 6 // 300
intc_0 // 0
callsub label33
frame_dig 5
dup
pushint 365
*
itob
frame_bury 1
intc_0 // 0
bytec 7 // "stakeAccumulator"
app_global_get_ex
assert
swap
itob
dup
frame_bury 4
b/
dup
frame_bury 3
pushbytes 0x // ""
b!=
bz label87
intc_0 // 0
bytec 11 // "rewardAccumulator"
app_global_get_ex
assert
itob
pushbytes 0x0f4240 // 0x0f4240
b*
frame_dig 3
dup
cover 2
b/
frame_dig 1
frame_dig 4
b/
b*
bytec 14 // "d"
b/
frame_bury 2
pushbytes 0x0a // 0x0a
frame_bury 0
pushbytes 0x45d964b800 // 0x45d964b800
b>
bz label88
pushbytes 0x5a // "Z"
frame_bury 0
label88:
intc_0 // 0
bytec 12 // "ewma"
app_global_get_ex
assert
pushbytes 0x // ""
b==
bz label89
frame_dig 2
dup
len
pushint 16
<=
assert
pushint 16
bzero
b|
bytec 12 // "ewma"
swap
app_global_put
label87:
callsub label26
intc_0 // 0
bytec 5 // "staked"
app_global_get_ex
assert
itob
intc_0 // 0
bytec 6 // "roundsPerDay"
app_global_get_ex
assert
itob
b*
dup
len
pushint 16
<=
assert
pushint 16
bzero
b|
bytec 7 // "stakeAccumulator"
swap
app_global_put
bytec 11 // "rewardAccumulator"
intc_0 // 0
app_global_put
global Round
dup
intc_0 // 0
bytec 6 // "roundsPerDay"
app_global_get_ex
assert
%
-
bytec 9 // "binRoundStart"
swap
app_global_put
label86:
retsub
label89:
intc_0 // 0
bytec 12 // "ewma"
app_global_get_ex
assert
bytec 14 // "d"
frame_dig 0
dup
cover 3
b-
b*
bytec 14 // "d"
b/
frame_dig 2
uncover 2
b*
bytec 14 // "d"
b/
b+
dup
len
pushint 16
<=
assert
pushint 16
bzero
b|
bytec 12 // "ewma"
swap
app_global_put
b label87
label26:
proto 0 0
pushbytes 0x // ""
txn FirstValid
pushint 12
<
bz label90
bytec 6 // "roundsPerDay"
intc 9 // 30857
app_global_put
retsub
label90:
txn FirstValid
intc_1 // 1
-
block BlkTimestamp
txn FirstValid
pushint 11
-
block BlkTimestamp
-
dup
frame_bury 0
bnz label91
bytec 6 // "roundsPerDay"
intc 9 // 30857
app_global_put
retsub
label91:
pushint 864000
frame_dig 0
/
bytec 6 // "roundsPerDay"
swap
app_global_put
retsub
